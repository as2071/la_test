<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Insert title here</title>
	<script type="text/javascript">
	
		var xhr = function(url) 
		{
		    return new Promise(function(resolve, reject)
	   		{
			      try 
			      {
			        var xmhr = new XMLHttpRequest();
			        //Listen for API Response
			        xmhr.onreadystatechange = function() 
			        {
			          if (xmhr.readyState == XMLHttpRequest.DONE && xmhr.status == 200) 
			        	  return resolve(xmhr.responseText);
			        };
			        //Open connection
			        xmhr.open("GET", url, true);
			        //Additional headers as needed
			        xmhr.withCredentials = true;
			        xmhr.setRequestHeader("Accept", "application/json");
			        //xmhr.setRequestHeader("Content-Type", "text/plain");
			        //Perform the actual AJAX call
			        xmhr.send();
			      } catch (ex) 
			      {
			        reject("Exception: Oh CORS's you've made a mistake!");
			      }
			    });
		  };
	
		function loadOnStart()
		{
			xhr(window.location.href + '/data').then(function(res)
			{
				var rowsStr = res.split("|");
				delete rowsStr[rowsStr.length-1];
				var rows = rowsStr.map(JSON.parse);
				var table = document.getElementById('output_table');
				var headerRow = table.insertRow(-1);
				var headers = ["first_name", "last_name", "product_name", "description", "price", "currency", "quantity", "purchase_date", "id"]
		        for (var i = 0; i < 9; i++) 
		        {
		            var headerCell = document.createElement("TH");
		            headerCell.innerHTML = customers[0][i];
		            headerRow.appendChild(headerCell);
		        }
				for (row of rows)
				{
					var newRow = table.insertRow(table.rows.length);
					for (val of row)
					{
						cell = newRow.insertCell(row.indexOf(val));
						cell.innerHTML = val;
					}
				}
		    });
		}
		window.onload = loadOnStart;
	</script>
</head>
<body>
	<h3>Data</h3>
	<table id="output_table"></table>
</body>
</html>