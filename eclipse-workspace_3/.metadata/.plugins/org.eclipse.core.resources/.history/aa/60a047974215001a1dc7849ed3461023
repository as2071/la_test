<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Insert title here</title>
	<script type="text/javascript">
	
		var xhr = function(url) 
		{
		    return new Promise(function(resolve, reject)
	   		{
			      try 
			      {
			        var xmhr = new XMLHttpRequest();
			        //Listen for API Response
			        xmhr.onreadystatechange = function() 
			        {
			          if (xmhr.readyState == XMLHttpRequest.DONE && xmhr.status == 200) 
			        	  return resolve(xmhr.responseText);
			        };
			        //Open connection
			        xmhr.open("GET", url, true);
			        //Additional headers as needed
			        xmhr.withCredentials = true;
			        xmhr.setRequestHeader("Accept", "application/json");
			        //xmhr.setRequestHeader("Content-Type", "text/plain");
			        //Perform the actual AJAX call
			        xmhr.send();
			      } catch (ex) 
			      {
			        reject("Exception: Oh CORS's you've made a mistake!");
			      }
			    });
		  };
	
		function loadOnStart()
		{
			xhr(window.location.href + '/data').then(function(res)
			{
				var allRowStrings = res.split("|")
				var allRowsJSON = allRowStrings.forEach(JSON.parse);
				var table = document.getElementById('output_table');
			    var jsonRow = res;
				var newRow = table.insertRow(table.rows.length);
				for (val of jsonRow)
				{
					cell = newRow.insertCell(jsonRow.indexOf(val));
					cell.innerHTML = val;
				}
		    });
		}
		window.onload = loadOnStart;
		
		/* async function retreiveData() // GET
		{		
		  	const response = await fetch(window.location.href + '/data');
		  	const tableData = await response.json(); //extract JSON from the http response
		  	var parsed = tableData
		  		//JSON.parse(tableData);
			var table = document.getElementById('output_table');
			var vals = '';
			var i;
			for (row of parsed)
			{
				var rowString = '<tr>';
				for (val of row)
				{
					rowString += '<td>' + val + '</td>'
				}
				rowString += '</tr>'
				vals += rowString;
			}
			table.innerHTML = vals;
		}
		window.onload = retreiveData; */
	</script>
</head>
<body>
	<h3>Data</h3>
	<table id="output_table"></table>
</body>
</html>